# Movies App - Product Roadmap

## Описание проекта

Групповое веб-приложение для отслеживания просмотренных фильмов с возможностью организации киновечеров в компании друзей.

**Целевая аудитория:** Группы друзей/коллег, которые регулярно смотрят фильмы вместе и хотят вести историю просмотров, планировать следующие киносеансы и делиться впечатлениями.

**Ключевая ценность:**

- Единое место для планирования и отслеживания совместных просмотров
- История того, что уже посмотрели вместе
- Возможность делиться мнениями и оценками
- Напоминания о запланированных киносеансах через Telegram

---

## Статус реализации

| Этап   | Название                     | API  | Frontend | Статус    |
| ------ | ---------------------------- | :--: | :------: | --------- |
| MVP    | Базовый функционал           |  ✅  |    ⏳    | Частично  |
| Этап 2 | Многопользовательские группы | ✅\* |    ❌    | Частично  |
| Этап 3 | Ролевая модель               |  ✅  |    ❌    | API готов |
| Этап 4 | Оценки и отзывы              |  ❌  |    ❌    | Не начат  |
| Этап 5 | Telegram бот                 |  ❌  |    ❌    | Не начат  |
| Этап 6 | Улучшение безопасности       |  ❌  |    ❌    | Не начат  |

\* Этап 2: API готов, кроме пригласительных ссылок

---

## MVP (Минимально жизнеспособный продукт)

**Цель:** Запустить базовую версию для одной тестовой группы пользователей с минимальным функционалом.

### API статус: ✅ Реализовано

#### 1. Регистрация и вход ✅

- [x] Регистрация через email и пароль
- [x] Вход в систему с получением токенов доступа
- [x] Базовая защита паролей (bcrypt, 12 rounds)
- [x] Двухтокеновая схема (access + refresh tokens)
- [x] Refresh token rotation
- [x] Logout с инвалидацией токена

#### 2. Пользователи ✅

- [x] Профиль пользователя (имя, email)
- [x] Просмотр своего профиля (`GET /users/me`)
- [x] Редактирование профиля
- [x] Удаление аккаунта
- [x] Создание пользователей админом

#### 3. Роли (упрощённая модель) ✅

- [x] **Админ** (глобальная роль) - управление пользователями и фильмами
- [x] **Обычный пользователь** - просмотр и участие в группах

#### 4. Фильмы ✅

- [x] **Поиск фильмов** через Kinopoisk API (`GET /movies/search`)
- [x] **Управление фильмами** (CRUD для админа)
- [x] Добавление в локальную базу по externalId или imdbId

#### 5. Группы ✅ (расширенная реализация)

- [x] Создание группы любым пользователем
- [x] Редактирование группы (модераторы+)
- [x] Удаление группы (админ группы)
- [x] Просмотр групп пользователя
- [x] Просмотр всех групп (глобальный админ)

#### 6. Фильмы в группах ✅

- [x] **Статусы фильма:**
  - **tracking** - фильм в списке, но пока без планов
  - **planned** - фильм с установленной датой просмотра
  - **watched** - фильм уже посмотрели
- [x] Добавление провайдерских фильмов в группу
- [x] Обновление статусов и дат
- [x] Редактирование данных фильма (с конвертацией в custom)
- [x] Удаление фильмов из группы

#### 7. Кастомные фильмы ✅ (бонус)

- [x] Создание фильмов вручную (не из Kinopoisk)
- [x] Полный CRUD для кастомных фильмов
- [x] Конвертация провайдерских фильмов в кастомные

### Frontend статус: ⏳ Требуется реализация

- [ ] Главная страница со списком фильмов
- [ ] Страница добавления фильма (поиск + выбор)
- [ ] Страница фильма (детальная информация)
- [ ] Страница профиля
- [ ] Страница групп
- [ ] Переключение между группами
- [ ] Админ-панель

### Безопасность ✅ Реализовано

- [x] JWT токены (access + refresh) с rotation
- [x] Bcrypt для паролей (12 rounds)
- [x] CORS с whitelist origins
- [x] CSRF защита
- [x] Helmet для HTTP headers
- [x] Rate limiting (short/medium/long tiers)

**Ограничения MVP (текущие):**

- ~~Только одна группа~~ → **Реализовано:** множественные группы
- ~~Нет возможности создавать новые группы~~ → **Реализовано:** создание групп
- Нет пригласительных ссылок (добавление участников модераторами)
- Нет оценок и отзывов
- Нет интеграций с Telegram

**Критерий успеха MVP:**
Группа из 5-10 человек успешно использует приложение для отслеживания совместных просмотров в течение месяца.

---

## Этап 2: Многопользовательские группы

**Цель:** Расширить приложение для работы с несколькими независимыми группами пользователей.

### API статус: ✅ Частично реализовано

#### 1. Группы ✅

- [x] **Создание группы:**
  - Любой пользователь может создать группу
  - При создании пользователь становится админом группы
  - Название, описание, аватар группы
- [x] **Управление группой:**
  - Редактирование информации о группе (модераторы+)
  - Удаление группы (только админ)
- [x] **Множественное членство:**
  - Пользователь может состоять в нескольких группах
  - Получение списка групп пользователя

#### 2. Приглашения в группы ❌ Не реализовано

- [ ] **Пригласительные ссылки:**
  - Генерация уникальной ссылки-приглашения
  - Настройка типа ссылки:
    - **Одноразовая** - деактивируется после первого использования
    - **Многоразовая** - можно использовать неограниченное число раз
    - **С ограничением по времени** - истекает через N дней
  - Деактивация ссылки вручную
- [ ] **Процесс приглашения:**
  - Переход по ссылке → автоматическое добавление в группу
  - Если пользователь не залогинен → регистрация/вход → добавление в группу

#### 3. Текущий механизм добавления ✅

- Добавление участников модераторами/админами вручную (по userId)

### Frontend статус: ❌ Не начат

- [ ] UI создания группы
- [ ] UI управления группой
- [ ] UI переключения между группами
- [ ] UI управления участниками
- [ ] Генерация пригласительных ссылок

**Зависимости:** MVP Frontend.

---

## Этап 3: Ролевая модель и права доступа

**Цель:** Внедрить гибкую систему ролей для распределения обязанностей внутри группы.

### API статус: ✅ Полностью реализовано

#### 1. Роли в группе ✅

- [x] **Админ** (владелец группы):
  - Управление настройками группы
  - Управление ролями участников
  - Удаление участников из группы
  - Передача прав владельца
  - Все права модератора
- [x] **Модератор:**
  - Управление фильмами (добавление, изменение статусов, удаление)
  - Добавление участников
  - Просмотр списков участников
- [x] **Обычный пользователь (member):**
  - Просмотр фильмов группы
  - Просмотр участников группы
  - Выход из группы

#### 2. Управление ролями ✅

- [x] Админ может назначать модераторов
- [x] Админ может понижать модераторов до обычных пользователей
- [x] Админ может передать права владельца другому участнику
- [x] Админ может удалять участников из группы
- [x] Защита: последний админ не может выйти из группы

#### 3. Guards реализованы ✅

- `GroupMemberGuard` - проверка членства в группе
- `GroupModeratorGuard` - проверка прав модератора или выше
- `GroupAdminGuard` - проверка прав админа группы

### Frontend статус: ❌ Не начат

- [ ] Индикаторы ролей рядом с именами пользователей
- [ ] Разные наборы действий в зависимости от роли
- [ ] Страница управления участниками для админов
- [ ] Модальное окно передачи владения

**Зависимости:** Этап 2 Frontend.

---

## Этап 4: Оценки и отзывы

**Цель:** Дать возможность участникам группы делиться мнениями о просмотренных фильмах.

### API статус: ❌ Не начат

#### 1. Оценки фильмов

- [ ] **Кто может оценивать:** Все участники группы
- [ ] **Когда можно оценивать:** Только фильмы со статусом "watched"
- [ ] **Тип оценки:** Числовая шкала (1-10)
- [ ] **Отображение:**
  - Средняя оценка по группе
  - Количество оценок
  - Индивидуальные оценки участников

#### 2. Отзывы на фильмы

- [ ] **Кто может писать:** Все участники группы
- [ ] **Когда можно писать:** Только для просмотренных фильмов
- [ ] **Формат:** Текстовый отзыв (опционально вместе с оценкой)
- [ ] **Отображение:**
  - Список отзывов под карточкой фильма
  - Имя автора и дата публикации
  - Возможность редактировать/удалять свой отзыв

#### 3. Таблицы БД

- [ ] `reviews` - оценки и отзывы

### Frontend статус: ❌ Не начат

- [ ] Раздел "Отзывы и оценки" на странице фильма
- [ ] Форма добавления оценки/отзыва
- [ ] Индикатор средней оценки в списках фильмов

**Зависимости:** Этап 2 Frontend.

---

## Этап 5: Telegram бот

**Цель:** Обеспечить быстрый доступ к информации о запланированных фильмах через Telegram.

### API статус: ❌ Не начат

#### 1. Привязка бота к группе

- [ ] **Механизм привязки:**
  - В веб-приложении генерируется уникальный код привязки
  - Пользователь отправляет код боту в личные сообщения
  - Бот привязывается к группе и чату Telegram
- [ ] **Альтернатива:**
  - Бот добавляется в групповой чат Telegram
  - Через команду в чате происходит привязка к группе в веб-приложении

#### 2. Команды бота

- [ ] `/start` - инструкция по привязке
- [ ] `/bind <код>` - привязка к группе
- [ ] `/upcoming` - список запланированных фильмов с датами
- [ ] `/watched` - последние просмотренные фильмы
- [ ] `/help` - помощь по командам

#### 3. Уведомления

- [ ] Напоминание о киносеансе за день
- [ ] Напоминание в день киносеанса
- [ ] Настройки уведомлений

#### 4. Таблицы БД

- [ ] `telegram_bindings` - привязка бота к группам

### Frontend статус: ❌ Не начат

- [ ] UI генерации кода привязки
- [ ] UI настроек уведомлений

**Зависимости:** Этап 2 (многопользовательские группы).

---

## Этап 6: Улучшение безопасности

**Цель:** Повысить защищённость аккаунтов пользователей.

### API статус: ❌ Не начат

#### 1. Двухфакторная аутентификация (2FA)

- [ ] **Методы 2FA:**
  - TOTP (Google Authenticator)
  - Опционально: Email коды
- [ ] **Процесс:**
  - Включение 2FA в настройках профиля
  - Генерация QR-кода для сканирования
  - Проверка кода при входе
- [ ] **Резервные коды:**
  - Генерация одноразовых резервных кодов
  - Возможность восстановления доступа

#### 2. OAuth провайдеры

- [ ] **Поддерживаемые провайдеры:**
  - Google
  - GitHub
  - Опционально: Яндекс, VK
- [ ] **Привязка аккаунтов:**
  - Регистрация через OAuth
  - Привязка OAuth к существующему аккаунту по email
- [ ] **Управление привязками:**
  - Просмотр привязанных аккаунтов
  - Отвязка OAuth провайдеров

#### 3. Расширенная безопасность

- [ ] История активных сессий
- [ ] Принудительный выход из всех сессий
- [ ] Уведомления о входах с новых устройств

#### 4. Таблицы БД

- [ ] `oauth_accounts` - OAuth провайдеры
- [ ] `totp_secrets` - 2FA секреты

### Frontend статус: ❌ Не начат

- [ ] UI включения 2FA
- [ ] UI привязки OAuth
- [ ] UI управления сессиями

**Зависимости:** MVP Frontend.

---

## Будущие улучшения (Backlog)

Идеи для дальнейшего развития (без приоритизации):

### Функции для фильмов

- Теги и категории фильмов
- Списки фильмов (например, "Любимые", "На выходные")
- Рейтинг популярности фильмов в группе
- Интеграция с другими API (IMDb)
- Подборки фильмов (рекомендации на основе просмотренного)

### Социальные функции

- Комментарии к отзывам
- Реакции на отзывы (лайки)
- Обсуждения в рамках группы
- Активность участников (кто больше смотрит, кто активнее пишет отзывы)

### Аналитика и статистика

- Статистика просмотров группы (фильмов в месяц, жанры)
- Личная статистика пользователя
- Графики и визуализации
- Экспорт истории просмотров

### Улучшения UX

- Мобильное приложение (PWA или нативное)
- Dark mode
- Кастомизация внешнего вида группы
- Уведомления в веб-приложении (Web Push)

### Интеграции

- Webhook'и для внешних сервисов
- API для сторонних приложений
- Экспорт данных (JSON, CSV)
- Синхронизация с календарём (Google Calendar, iCal)

---

## Технические детали

### Технологический стек

- **Frontend:** SvelteKit + Vite
- **Backend:** NestJS + Fastify
- **Database:** PostgreSQL + Drizzle ORM
- **Deployment:** Docker Compose, Nginx, Let's Encrypt
- **External API:** Kinopoisk API
- **Future:** Telegram Bot API

### Инфраструктура

- Монorepo структура (Turborepo + pnpm)
- CI/CD через GitHub Actions
- Миграции БД через Drizzle Kit
- Автоматический деплой на VPS

### Безопасность (реализовано)

- JWT токены (access + refresh) с rotation
- Bcrypt для паролей (12 rounds)
- CORS с whitelist origins
- CSRF защита (@fastify/csrf-protection)
- Helmet для HTTP headers
- Rate limiting с различными tier-ами

---

## Метрики успеха

### MVP

- 5-10 активных пользователей в тестовой группе
- 20+ фильмов добавлено в группу
- 10+ фильмов просмотрено
- Стабильная работа в течение месяца

### Этап 2-3

- 3+ активных групп
- 30+ пользователей суммарно
- Еженедельная активность (добавление/просмотр фильмов)

### Этап 4-5

- Средняя вовлечённость: 50%+ пользователей оставляют отзывы
- Telegram бот используется минимум 50% групп
- NPS (Net Promoter Score) > 50

---

## Примечания

- Приоритет фич в каждом этапе может меняться на основе фидбека пользователей
- Этапы 4-6 могут выполняться частично параллельно
- MVP критически важен для валидации гипотезы о полезности продукта
- Все этапы предполагают написание тестов и документацию
