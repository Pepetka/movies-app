# Movies App - Product Roadmap

## Описание проекта

Групповое веб-приложение для отслеживания просмотренных фильмов с возможностью организации киновечеров в компании друзей.

**Целевая аудитория:** Группы друзей/коллег, которые регулярно смотрят фильмы вместе и хотят вести историю просмотров, планировать следующие киносеансы и делиться впечатлениями.

**Ключевая ценность:**

- Единое место для планирования и отслеживания совместных просмотров
- История того, что уже посмотрели вместе
- Возможность делиться мнениями и оценками
- Напоминания о запланированных киносеансах через Telegram

---

## MVP (Минимально жизнеспособный продукт)

**Цель:** Запустить базовую версию для одной тестовой группы пользователей с минимальным функционалом.

**Сроки:** Первая итерация

### Основной функционал

#### 1. Регистрация и вход

- Регистрация через email и пароль
- Вход в систему с получением токенов доступа
- Базовая защита паролей (хеширование)
- Двухтокеновая схема (access + refresh tokens)

#### 2. Пользователи

- Профиль пользователя (имя, email)
- Просмотр своего профиля
- Одна захардкоженная группа для всех пользователей
- Все пользователи добавляются вручную через админку

#### 3. Роли (упрощённая модель)

- **Админ** - создатель приложения, один человек
  - Добавляет новых пользователей
  - Управляет всеми фильмами
  - Переводит фильмы между статусами
- **Обычный пользователь** - все остальные
  - Просматривают список фильмов
  - Видят статусы и даты

#### 4. Фильмы

- **Поиск фильмов** через TMDB API
  - Поиск по названию
  - Отображение базовой информации (постер, название, год, описание)
- **Добавление фильма** в группу (только админ)
- **Статусы фильма:**
  - **Отслеживается** - фильм в списке, но пока без планов
  - **Планируется** - фильм с установленной датой просмотра
  - **Просмотрен** - фильм уже посмотрели
- **Управление статусами** (только админ):
  - Перевод фильма из статуса в статус
  - Установка даты просмотра для статуса "Планируется"
  - Пометка как "Просмотрен"
- **Списки фильмов:**
  - Все фильмы группы
  - Фильтрация по статусам
  - Сортировка по дате добавления/просмотра

#### 5. Административная панель (MVP)

- Простая веб-страница `/admin`
- Доступна только пользователю с ролью админа
- Функции:
  - Просмотр списка всех пользователей
  - Добавление нового пользователя (создание учётки)
  - Удаление пользователя

#### 6. UI/UX (минималистичный)

- Главная страница со списком фильмов
- Страница добавления фильма (поиск + выбор)
- Страница фильма (детальная информация)
- Страница профиля
- Админ-панель

**Ограничения MVP:**

- Только одна группа (захардкожена)
- Нет возможности создавать новые группы
- Нет приглашений пользователей (только через админку)
- Нет оценок и отзывов
- Нет разграничения прав (кроме админа)
- Нет интеграций с Telegram

**Критерий успеха MVP:**
Группа из 5-10 человек успешно использует приложение для отслеживания совместных просмотров в течение месяца.

---

## Этап 2: Многопользовательские группы

**Цель:** Расширить приложение для работы с несколькими независимыми группами пользователей.

### Новый функционал

#### 1. Группы

- **Создание группы:**
  - Любой пользователь может создать группу
  - При создании пользователь становится админом группы
  - Название, описание, аватар группы
- **Управление группой:**
  - Редактирование информации о группе
  - Архивация/удаление группы
- **Множественное членство:**
  - Пользователь может состоять в нескольких группах
  - Переключение между группами в UI

#### 2. Приглашения в группы

- **Пригласительные ссылки:**
  - Генерация уникальной ссылки-приглашения
  - Настройка типа ссылки:
    - **Одноразовая** - деактивируется после первого использования
    - **Многоразовая** - можно использовать неограниченное число раз
    - **С ограничением по времени** - истекает через N дней
  - Деактивация ссылки вручную
- **Процесс приглашения:**
  - Переход по ссылке → автоматическое добавление в группу
  - Если пользователь не залогинен → регистрация/вход → добавление в группу

#### 3. Обновлённая админка

- Удалить функцию ручного добавления пользователей
- Заменить на управление пригласительными ссылками

**Зависимости:** Требуется завершить MVP.

---

## Этап 3: Ролевая модель и права доступа

**Цель:** Внедрить гибкую систему ролей для распределения обязанностей внутри группы.

### Роли и права

#### 1. Роли в группе

- **Админ** (владелец группы):
  - Управление настройками группы
  - Управление ролями участников
  - Удаление участников из группы
  - Все права модератора
- **Модератор:**
  - Управление фильмами (добавление, изменение статусов, удаление)
  - Просмотр списков участников
- **Обычный пользователь:**
  - Просмотр фильмов группы
  - Добавление оценок и отзывов (см. Этап 4)

#### 2. Управление ролями

- Админ может назначать модераторов
- Админ может понижать модераторов до обычных пользователей
- Админ может передать права владельца другому участнику
- Админ может удалять участников из группы

#### 3. UI изменения

- Индикаторы ролей рядом с именами пользователей
- Разные наборы действий в зависимости от роли
- Страница управления участниками для админов

**Зависимости:** Этап 2 (многопользовательские группы).

---

## Этап 4: Оценки и отзывы

**Цель:** Дать возможность участникам группы делиться мнениями о просмотренных фильмах.

### Функционал

#### 1. Оценки фильмов

- **Кто может оценивать:** Все участники группы
- **Когда можно оценивать:** Только фильмы со статусом "Просмотрен"
- **Тип оценки:** Числовая шкала (например, 1-10 или 1-5 звёзд)
- **Отображение:**
  - Средняя оценка по группе
  - Количество оценок
  - Индивидуальные оценки участников (видны всем)

#### 2. Отзывы на фильмы

- **Кто может писать:** Все участники группы
- **Когда можно писать:** Только для просмотренных фильмов
- **Формат:** Текстовый отзыв (опционально вместе с оценкой)
- **Отображение:**
  - Список отзывов под карточкой фильма
  - Имя автора и дата публикации
  - Возможность редактировать/удалять свой отзыв

#### 3. UI изменения

- Раздел "Отзывы и оценки" на странице фильма
- Форма добавления оценки/отзыва
- Индикатор средней оценки в списках фильмов

**Зависимости:** Этап 3 (ролевая модель).

---

## Этап 5: Telegram бот

**Цель:** Обеспечить быстрый доступ к информации о запланированных фильмах через Telegram.

### Функционал бота

#### 1. Привязка бота к группе

- **Механизм привязки:**
  - В веб-приложении генерируется уникальный код привязки
  - Пользователь отправляет код боту в личные сообщения
  - Бот привязывается к группе и чату Telegram
- **Альтернатива:**
  - Бот добавляется в групповой чат Telegram
  - Через команду в чате происходит привязка к группе в веб-приложении

#### 2. Команды бота

- `/start` - инструкция по привязке
- `/bind <код>` - привязка к группе
- `/upcoming` - список запланированных фильмов с датами
- `/watched` - последние просмотренные фильмы
- `/help` - помощь по командам

#### 3. Уведомления (автоматические)

- **Напоминание о киносеансе:**
  - За день до запланированной даты
  - В день киносеанса (утром)
- **Настройки уведомлений:**
  - Включение/выключение напоминаний
  - Выбор времени напоминаний

#### 4. Дополнительные возможности (опционально)

- Быстрое добавление оценки через бот после просмотра
- Голосование за следующий фильм

**Зависимости:** Этап 2 (многопользовательские группы).

---

## Этап 6: Улучшение безопасности

**Цель:** Повысить защищённость аккаунтов пользователей.

### Функционал

#### 1. Двухфакторная аутентификация (2FA)

- **Методы 2FA:**
  - TOTP (Time-based One-Time Password) через приложения типа Google Authenticator
  - Опционально: SMS/Email коды
- **Процесс:**
  - Включение 2FA в настройках профиля
  - Генерация QR-кода для сканирования
  - Проверка кода при входе
- **Резервные коды:**
  - Генерация одноразовых резервных кодов при включении 2FA
  - Возможность восстановления доступа

#### 2. OAuth провайдеры

- **Поддерживаемые провайдеры:**
  - Google
  - GitHub
  - Возможно: Яндекс, VK
- **Привязка аккаунтов:**
  - Регистрация через OAuth
  - Привязка OAuth к существующему аккаунту по email
- **Управление привязками:**
  - Просмотр привязанных аккаунтов
  - Отвязка OAuth провайдеров

#### 3. Расширенная безопасность

- История активных сессий
- Принудительный выход из всех сессий
- Уведомления о входах с новых устройств

**Зависимости:** Можно реализовать независимо после MVP.

---

## Будущие улучшения (Backlog)

Идеи для дальнейшего развития (без приоритизации):

### Функции для фильмов

- Теги и категории фильмов
- Списки фильмов (например, "Любимые", "На выходные")
- Рейтинг популярности фильмов в группе
- Интеграция с другими API (IMDb, Kinopoisk)
- Подборки фильмов (рекомендации на основе просмотренного)

### Социальные функции

- Комментарии к отзывам
- Реакции на отзывы (лайки)
- Обсуждения в рамках группы
- Активность участников (кто больше смотрит, кто активнее пишет отзывы)

### Аналитика и статистика

- Статистика просмотров группы (фильмов в месяц, жанры)
- Личная статистика пользователя
- Графики и визуализации
- Экспорт истории просмотров

### Улучшения UX

- Мобильное приложение (PWA или нативное)
- Dark mode
- Кастомизация внешнего вида группы
- Уведомления в веб-приложении (Web Push)

### Интеграции

- Webhook'и для внешних сервисов
- API для сторонних приложений
- Экспорт данных (JSON, CSV)
- Синхронизация с календарём (Google Calendar, iCal)

---

## Технические детали

### Технологический стек

- **Frontend:** SvelteKit (Svelte 5) + Vite
- **Backend:** NestJS 11 + Fastify
- **Database:** PostgreSQL + Drizzle ORM
- **Deployment:** Docker Compose, Nginx, Let's Encrypt
- **External API:** TMDB (The Movie Database)
- **Future:** Telegram Bot API

### Инфраструктура

- Монorepo структура (Turborepo + pnpm)
- CI/CD через GitHub Actions
- Миграции БД через Drizzle Kit
- Автоматический деплой на VPS

### Безопасность (реализовано)

- JWT токены (access + refresh) с rotation
- Bcrypt для паролей (12 rounds)
- CORS с whitelist origins
- CSRF защита (@fastify/csrf-protection)
- Helmet для HTTP headers
- Rate limiting с различными tier-ами

---

## Метрики успеха

### MVP

- 5-10 активных пользователей в тестовой группе
- 20+ фильмов добавлено в группу
- 10+ фильмов просмотрено
- Стабильная работа в течение месяца

### Этап 2-3

- 3+ активных групп
- 30+ пользователей суммарно
- Еженедельная активность (добавление/просмотр фильмов)

### Этап 4-5

- Средняя вовлечённость: 50%+ пользователей оставляют отзывы
- Telegram бот используется минимум 50% групп
- NPS (Net Promoter Score) > 50

---

## Примечания

- Приоритет фич в каждом этапе может меняться на основе фидбека пользователей
- Этапы 2-6 могут выполняться частично параллельно
- MVP критически важен для валидации гипотезы о полезности продукта
- Все этапы предполагают написание тестов и документации
